!function(e){e.fn.iziCalendar=function(t){var a=function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=[],a=0;a<5;a++){var n=Math.floor(Math.random()*e.length);t.push(e.substring(n,n+1))}return t.join("")}()+"-",n=0,l=["MÅN","TIS","ONS","TOR","FRE","LÖR","SÖN"],r=[],s={transparent:["transparent","gray","whitesmoke"],orange:["orange","white","orange"],blue:["#51b1e7","white","deepskyblue"],green:["forestgreen","white","greenyellow"],red:["indianred","white","orangered"],pink:["hotpink","white","lightpink"],purple:["mediumpurple","white","rebeccapurple"],selectedcell:["whitesmoke","black","whitesmoke"]},i=["Jan","Feb","Mar","Apr","Maj","Jun","jul","Aug","Sep","Okt","Nov","Dec"],c=[],o=e.extend({getUrl:"",deleteUrl:"",locale:"sv",saveUrl:"",selectable:!0,singleSelect:!1,singleSelectWithTime:!1,outputStartElements:[],outputEndElements:[]},t);function d(e,t){var a=new Date(e);return a.setDate(e.getDate()+t),a}function h(e){return e.getFullYear()+"-"+p(e.getMonth()+1)+"-"+p(e.getDate())}function g(e){for(var t=[],a=0;a<24;a++)for(var n=0;n<60;n+=15){var l=p(a)+":"+p(n),r="";(e&&8===a||!e&&17===a)&&0===n&&(r=' selected="selected"'),t.push('<option value="'+l+'"'+r+">"+l+"</option>")}return t.join("")}function p(e){return e<10?"0"+e:e}function u(t){new Date(t).setDate(1),function(t){var n=s.transparent;e(".calendarcell").css("background-color",n[0]),e(".calendarcell a").css("color",n[1]),e(".calendarcell").removeClass("selectedcell"),e(".calendarcell").removeClass("izicalendar-red"),e(".calendarcell").removeClass("izicalendar-green"),e(".calendarcell").removeClass("izicalendar-blue"),e(".calendarcell").removeClass("izicalendar-orange"),e(".calendarcell").removeClass("izicalendar-pink"),e(".calendarcell").removeClass("izicalendar-purple");var l=new Date(t),c=new Date(t),o=new Date(t);c.setMonth(l.getMonth()+1),o.setMonth(l.getMonth()-1),l.setDate(1);var d=l.getDay();0===d&&(d=7);var h=1,g=1,u=1,m=c.getFullYear()+"-"+p(c.getMonth()+1),f=o.getFullYear()+"-"+p(o.getMonth()+1),b=l.getFullYear()+"-"+p(l.getMonth()+1);e("#"+a+"next").html('<svg style="width:24px;height:24px"><path fill="#000000" d="M4,11V13H16L10.5,18.5L11.92,19.92L19.84,12L11.92,4.08L10.5,5.5L16,11H4Z" /></svg>'),e("#"+a+"next").attr("href","#"+m),e("#"+a+"back").html('<svg style="width:24px;height:24px"><path fill="#000000" d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>'),e("#"+a+"back").attr("href","#"+f),e("#"+a+"SelectedDate").html(i[l.getMonth()]+", "+l.getFullYear()),e("#"+a+" .calendarcell a").each(function(){e(this).hasClass("not-in-selected-month")&&(e(this).removeClass("not-in-selected-month"),e(this).css("color","gray"));var a=!1,n=b+"-"+p(h),i=v(e(this).attr("id"));if(i===d.toString())e(this).html(h),h++;else if(i>d){var c=new Date(t);c.setDate(h),c.getMonth()===l.getMonth()?(e(this).html(h),h++):(e(this).html(g),a=!0,n=m+"-"+p(g),g++)}else{var o=new Date(t);a=!0,o.setDate(u-d+1),n=f+"-"+o.getDate(),e(this).html(o.getDate()),u++}e(this).attr("href","#"+n),r.indexOf(n)>-1&&(e(this).parent().css("background-color",s.selectedcell[0]),e(this).parent().addClass("selectedcell")),a&&(e(this).css("color","lightgray"),e(this).addClass("not-in-selected-month"))})}(t),e("#userid").length>0&&""!=o.getUrl&&e.getJSON(o.getUrl+e("#userid").val()+"?date="+e("#"+a+"1").attr("href").replace("#","")).done(function(t){for(var n=0;n<t.length;n++)c.push(t[n]);e("#"+a+" .calendarcell a").each(function(){e(this).attr("title","");var t=v(e(this).attr("href")).replace("#",""),a=-1;if(null!=c&&c.length>0){var n=m(t),l=void 0!==n&&null!==n?n.Status:-1;l>-1&&(a=l,e(this).attr("title",n.Name+": "+n.StartDate+", "+n.StartTime+"-"+n.EndTIme))}var r="transparent";switch(a){case 1:r="orange";break;case 2:r="blue";break;case 3:r="red";break;case 4:r="pink";break;case 5:r="green";break;case 7:r="purple"}e(this).hasClass("not-in-selected-month")&&e(this).removeClass("not-in-selected-month"),e(this).parent().addClass("izicalendar-"+r),"transparent"!==r&&e(this).css("color",s[r][1]),e(this).parent().css("background-color",s[r][0])})}).fail(function(e,t,a){alert("Request Failed: "+(t+", "+a+","+e))})}function v(e){return e.replace(a,"")}function m(e){for(var t=new Date(e),a=0;a<c.length;a++){var n=new Date(c[a].StartDate),l=new Date(c[a].EndDate);if(n.getTime()===t.getTime()||t>n&&t<=l)return c[a]}return null}function f(e){return e.split(" ")[1]}function b(t,a){if(t.length>0)for(var n=0;n<t.length;n++){var l=e("#"+t[n]);l.length>0&&(l.is("input")?o.singleSelect?l.val(l.val()+","+a):l.val(a):o.singleSelect?l.append(y(a)):l.html('<span class="intervalselectdate">'+a+"</span>"))}}function y(e){var t=e,n="",l="";if(o.singleSelectWithTime){n=" - ";var r=e.split(",");t=r[0].split(" ")[0],l=' <span class="singleselectstarttime">'+f(r[0])+"</span><span>"+n+'</span> <span class="singleselectendtime">'+f(r[1])+"</span>"}return'<div class="singleselectvaluecontainer" style="margin-bottom: 2px;padding: 1em;background-color: white;border: 1px solid lightgray;"><button style="background-color:transparent;border:0;margin:0;padding:0 2em 0 0;vertical-align:middle;cursor:pointer" title="Ta bort post" class="'+a+'singleselectdelbtn"><svg style="width:24px;height:24px" viewBox="0 0 24 24"><path fill="gray" d="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z" /></svg></button><span class="singleselectdate">'+t+"</span>"+l+"</div>"}return n=e(this).width()/7,e(this).html('<div id="'+a+'" class="calendarContainer iziCalendar" style="background-color:white"><input type="text" id="'+a+'intervalstartdate" style="display:none" /><input type="text" id="'+a+'intervalenddate" style="display:none" /><table style="margin-bottom: 1em;border-collapse: separate;border-spacing: 0 1px;margin: 0;width: 100%"><tr><td><a class="navigateCalendar" id="'+a+'back"></a></td><td style="text-align:center" id="'+a+'SelectedDate"></td><td style="text-align:right"><a class="navigateCalendar" id="'+a+'next"></a></td></tr><table><div id="'+a+'MonthCalendarContainer"><table style="border-collapse: separate;border-spacing: 0 1px;margin: 0;width: 100%" id="'+a+'MonthCalendar"></table><div style="clear:both"></div><div id="'+a+'SelectedDayContainer"></div></div> <div id="'+a+'DayCalendarContainer"><div id="'+a+'DayCalendar"></div></div></div></div>'),e("#"+a+"MonthCalendar").html(function(){var e=[];e.push("<tr>");for(var t=0;t<7;t++)e.push('<th style="text-align:center; font-size:0.8em;font-weight:300">'+l[t]+"</th>");e.push("</tr>");for(var r=1,s=0;s<6;s++){e.push("<tr>");for(var i=0;i<7;i++)e.push('<td class="calendarcell" style="padding:0;margin: 1px;width:'+n+"px;height:"+n/1.6+"px;line-height:"+n/1.6+'px"><a href="#" id="'+a+r+'" style="text-decoration: none;color: gray;display: block;height:100%;text-align:center" onMouseOver="this.style.backgroundColor=\'#f5f5f5\'" onMouseOut="this.style.backgroundColor=\'transparent\'"></a></td>'),r++;e.push("</tr>")}return e.join("")}()),u(h(new Date)),e("#"+a+" .navigateCalendar").click(function(){var t=e(this).attr("href").replace("#","");t.length>7||u(t)}),e(document).on("click","."+a+"timecontainerdelbtn",function(){e(this).closest(".choosetimecontainer").remove()}),e(document).on("click","."+a+"singleselectdelbtn",function(){var t=e(this).closest(".singleselectvaluecontainer").find(".singleselectdate").html();!function(t){if(!o.singleSelect)return;if(o.outputStartElements.length>0)for(var a=0;a<o.outputStartElements.length;a++){var n=e("#"+o.outputStartElements[a]);if(n.length>0&&n.is("input")){for(var l=n.val().split(","),r=[],s=0;s<l.length;s++)l[s].indexOf(t)<0&&r.push(l[s]);n.val(r.join(","))}}}(t);var n=r.indexOf(t);n>-1&&r.slice(n,1);var l=e("#"+a+' a[href="#'+t+'"]');l.length>0&&(l.parent().css("background-color",s.transparent[0]),l.parent().removeClass("selectedcell")),e(this).closest(".singleselectvaluecontainer").remove()}),e(window).resize(function(){var t={width:(n=e(this).width()/7)+"px",height:n/1.6+"px",lineHeight:n/1.6+"px",padding:0,margin:"1px"};e("#"+a+" .calendarcell").css(t)}),e(document).on("click","."+a+"savestartendtimebtn",function(){var t=e(this).closest(".choosetimecontainer"),a=t.find(".selecteddate").val(),n=a+" "+t.find(".starttime").val()+","+(a+" "+t.find(".endtime").val());r.push(a),b(o.outputStartElements,n),t.parent().find("a").parent().css("background-color",s.selectedcell[0]),t.parent().find("a").parent().addClass("selectedcell"),t.remove()}),o.selectable&&e(document).on("click","#"+a+" .calendarcell a",function(){var t=e(this).attr("href").replace("#",""),n=new Date(t),l=new Date,i=!1;if(!o.singleSelectWithTime&&(r.length>1||0===r.length))e(".calendarcell").removeClass("selectedcell"),e(".calendarcell").css("background-color",s.transparent[0]),(r=[]).push(t),i=!0,b(o.outputStartElements,t),b(o.outputEndElements,""),e("#"+a+"intervalstartdate").val(t),e("#"+a+"intervalenddate").val("");else if(l=new Date(r[0]),!o.singleSelect&&n<l)return;if(o.singleSelect)if(o.singleSelectWithTime){if(e(".choosetimecontainer").remove(),e(this).parent().hasClass("selectedcell"))return;e(this).parent().append('<div class="choosetimecontainer" style="line-height:20px;position: absolute;width: 200px;border: 0.8px solid lightgray;padding: 10px; background-color: whitesmoke;"><div style="text-align:right"><button style="background-color:transparent;border:0;margin:0;padding:0;cursor:pointer" class="'+a+'timecontainerdelbtn"><svg style="width:24px;height:24px" viewBox="0 0 24 24"><path fill="gray" d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" /></svg></button></div><div style="text-align:center">Välj start & sluttid</div><hr /><div style="text-align:center"><select class="form-control starttime">'+g(!0)+'</select> - <select class="form-control endtime">'+g(!1)+'</select><hr /><input type="hidden" class="selecteddate" value="'+t+'" /></div><button style="margin-top:5px" class="btn btn-block '+a+'savestartendtimebtn">Spara</button></div>')}else b(o.outputStartElements,t);else if(1===r.length&&!i){for(var c=new Date(r[0]);c<n;)c=d(c,1),r.push(h(c));b(o.outputEndElements,t),e("#"+a+"intervalenddate").val(t)}if(!o.singleSelectWithTime)for(var p=0;p<r.length;p++){console.log(r[p]);var u=e("#"+a+' a[href="#'+r[p]+'"]');u.length>0&&!u.parent().hasClass("selectedcell")&&(u.parent().css("background-color",s.selectedcell[0]),u.parent().addClass("selectedcell"))}}),this}}(jQuery);